<script>
	import Content from '@app/ui/Content.svelte';
	import BlogPostList from './BlogPostList.svelte';
	// import BlogPostListItem from './BlogPostListItem.svelte';
	import BlogPostInput from './BlogPostInput.svelte';
	import BlogPost from './BlogPost.svelte';
	import Button from '@app/ui/Button.svelte';
	import { id } from '../../../routes/_data.js';

	// TODO the ui here badly needs animations
	// to make it less confusing when you toggle the drafts

	export let posts;
	// $: console.log('blog posts', posts);

	export let showDraft = false;

	const AUTHOR_NAME = 'ryan';

	const toggleDraft = () => {
		showDraft = !showDraft;
	};

	export let titleValue = '';
	export let contentValue = '';

	export let titleEl;
	export let contentEl;

	$: hasDraft = Boolean(titleValue || contentValue);

	const submit = () => {
		// TODO publish confirmation
		// TODO show good errors where they occur (forms library!)
		// console.log('submit blog post', titleValue, contentValue);
		if (!titleValue) {
			titleEl.focus();
			return;
		}
		if (!contentValue) {
			contentEl.focus();
			return;
		}
		posts = [
			{
				author: AUTHOR_NAME,
				id: id(),
				title: titleValue,
				content: contentValue,
			},
			...posts,
		];
		titleValue = '';
		contentValue = '';
		showDraft = false;
	};
</script>

<!--
	TODO replace this and other `max-width: 640px` stuff
	with a <Container/> or <Cell /> or <Box /> or something
-->
<div class="flex-1 flex flex-col p-2" style="max-width: 640px;">
	{#if showDraft}
		<BlogPostInput
			bind:value={titleValue}
			bind:el={titleEl}
			placeholder="blog post title.." />
		<BlogPostInput
			bind:value={contentValue}
			bind:el={contentEl}
			placeholder="..content." />
		<div class="mt-2">
			<Button on:click={toggleDraft}>~ stash draft</Button>
			<Button on:click={submit}>! publish this post</Button>
		</div>
	{:else}
		<div>
			<Button on:click={toggleDraft}>
				{#if hasDraft}+ resume draft{:else}+ write a new post{/if}
			</Button>
		</div>
	{/if}
	{#if showDraft && hasDraft}
		<div class="border-4 rounded-bl-lg rounded-tr-lg border-purple-200">
			<BlogPost
				post={{ author: AUTHOR_NAME, title: titleValue, content: contentValue }} />
		</div>
	{/if}
	<BlogPostList {posts} />
</div>
