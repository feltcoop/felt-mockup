<script>
	import InboxList from './InboxList.svelte';
	import InboxInput from './InboxInput.svelte';
	import InboxListItem from './InboxListItem.svelte';
	import data, { id } from '../../../routes/_data.js';

	// TODO should type="inbox" be type="activity"?

	const { session } = data;

	export let notes;

	export let contentValue = '';
	export let titleValue = '';
	export let contentEl;

	const submit = () => {
		if (!contentValue && !titleValue) {
			contentEl.focus();
			return;
		}
		// console.log('submit content', contentValue, titleValue);
		notes = [
			{
				author: session.person.name,
				id: id(),
				content: contentValue,
				title: titleValue,
			},
			...notes,
		];
		contentValue = '';
		titleValue = '';
	};

	const submitTitle = () => {
		contentEl.focus();
	};

	// TODO need a store per chat that saves the input state
</script>

<div class="flex flex-col h-full">
	<InboxInput
		placeholder="..notes notes..."
		bind:value={contentValue}
		bind:el={contentEl}
		{submit} />
	<InboxInput
		placeholder="title?"
		bind:value={titleValue}
		submit={submitTitle} />
	{#if contentValue || titleValue}
		<div class="flex border-4 border-purple-200 rounded-bl-lg rounded-tr-lg">
			<InboxListItem
				note={{ author: session.person.name, content: contentValue, title: titleValue }} />
		</div>
	{/if}
	<div class="overflow-y-scroll flex flex-col flex-1">
		<InboxList {notes} />
	</div>
</div>
