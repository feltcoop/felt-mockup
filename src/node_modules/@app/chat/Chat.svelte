<script>
	import ChatMessages from './ChatMessages.svelte';
	import ChatMessage from './ChatMessage.svelte';
	import ChatInput from './ChatInput.svelte';
	import { id } from '../../../routes/_data.js';
	import { useSession } from '@app/session/context.js';

	export let messages;

	const session = useSession();

	export let value = '';

	const submit = content => {
		// console.log('submit content', content);
		messages = [
			...messages,
			{ type: 'message', author: $session.person.slug, id: id(), content },
		];
		value = '';
	};

	// TODO need a store per chat that saves the input state
</script>

<div class="flex flex-col h-full">
	<div
		class="overflow-y-scroll flex flex-col justify-end flex-1 border-4
		border-b-0 border-purple-200 rounded-tr-lg">
		<ChatMessages {messages} />
		{#if value}
			<div class="border-4 border-purple-200 rounded-bl-lg rounded-tr-lg">
				<ChatMessage
					message={{ author: $session.person.slug, content: value }} />
			</div>
		{/if}
	</div>
	<ChatInput bind:value {submit} />
</div>
